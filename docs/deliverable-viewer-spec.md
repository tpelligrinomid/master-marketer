# Deliverable Viewer & Editor — Feature Spec for MiD App

## Overview

Build a **Deliverable Viewer** — a branded, beautiful rendering layer for marketing deliverables generated by the master-marketer backend. Strategists review and edit deliverables before publishing. Clients receive a shareable link to view the final deliverable in the browser. Deliverables can also be exported as PDF.

This is a core differentiator for Marketers in Demand — the presentation quality of these deliverables is what makes them feel like a $15K+ consulting engagement.

---

## Deliverable Types

There are **4 client-facing deliverable types**, each with its own visual treatment:

### 1. Research Report (long-form document)
- 25,000–35,000 words across 8+ sections
- Heavy use of markdown: headings, tables, bold text, inline links, bullet lists
- Includes a competitive scoring matrix (rendered as a styled comparison table)
- Includes a table of contents with anchor links
- Each section has: section_number, section_title, markdown content, word_count
- This is the most complex deliverable — think premium consulting report

### 2. Roadmap (visual, phased)
- Structured data: phases → initiatives → success metrics
- Each phase has: name, timeframe, objectives, initiatives (with priority: high/medium/low), success_metrics
- Includes a risk assessment table (risk, mitigation, likelihood)
- **This should feel visual and interactive** — timeline/swimlane layout, color-coded priorities, expandable phases
- NOT just rendered markdown — this is structured data that deserves a custom visual layout

### 3. Plan (strategic marketing plan)
- Structured data: objective, channels, tactics, timeline, milestones
- Each tactic has: name, channel, description, timeline, KPIs, budget estimate
- Includes success metrics with targets and measurement methods
- Timeline with start/end dates and milestones
- Should render as a structured document with tactic cards, a timeline visualization, and metric dashboards

### 4. Creative Brief (simpler format)
- Structured data: project name, background, objective, target audience, key messages, deliverables, requirements, constraints
- Simpler layout — clean document format
- Mostly internal but occasionally shared with clients

---

## Data Structures from Backend

The backend (master-marketer) returns these JSON structures. The viewer needs to consume and render them.

### Research Output
```typescript
interface ResearchOutput {
  type: "research";
  title: string;                    // e.g. "Marketing Research: Bionomous"
  summary: string;                  // Executive summary paragraph
  sections: Array<{
    section_number: number;
    section_title: string;
    markdown: string;               // Full markdown content for this section
    word_count: number;
  }>;
  competitive_scores: Record<string, {
    organic_seo: number;            // 1-10
    social_media: number;
    content_strategy: number;
    paid_media: number;
    brand_positioning: number;
    overall: number;
    justification: {
      organic_seo: string;
      social_media: string;
      content_strategy: string;
      paid_media: string;
      brand_positioning: string;
    };
  }>;
  full_document_markdown: string;   // Complete assembled document
  metadata: {
    model: string;
    version: number;
    generated_at: string;           // ISO timestamp
    total_word_count: number;
    intelligence_summary: {
      companies_analyzed: number;
      data_sources_succeeded: number;
      data_sources_failed: number;
      errors: string[];
    };
  };
}
```

### Roadmap Output
```typescript
interface RoadmapOutput {
  type: "roadmap";
  title: string;
  summary: string;
  content_structured: {
    type: "roadmap";
    vision: string;
    time_horizon: string;
    phases: Array<{
      name: string;
      timeframe: string;
      objectives: string[];
      initiatives: Array<{
        title: string;
        description: string;
        priority: "high" | "medium" | "low";
        dependencies: string[];
      }>;
      success_metrics: string[];
    }>;
    risks: Array<{
      risk: string;
      mitigation: string;
      likelihood: "high" | "medium" | "low";
    }>;
  };
  metadata: { model: string; version: number; generated_at: string; };
}
```

### Plan Output
```typescript
interface PlanOutput {
  type: "plan";
  title: string;
  summary: string;
  content_structured: {
    type: "plan";
    objective: string;
    target_audience: string;
    channels: string[];
    tactics: Array<{
      tactic: string;
      channel: string;
      description: string;
      timeline: string;
      kpis: string[];
      budget_estimate: string | null;
    }>;
    success_metrics: Array<{
      metric: string;
      target: string;
      measurement_method: string;
    }>;
    timeline: {
      start_date: string;
      end_date: string;
      milestones: Array<{ date: string; milestone: string }>;
    };
  };
  metadata: { model: string; version: number; generated_at: string; };
}
```

### Brief Output
```typescript
interface BriefOutput {
  type: "brief";
  title: string;
  summary: string;
  content_structured: {
    type: "brief";
    project_name: string;
    background: string;
    objective: string;
    target_audience: string;
    key_messages: string[];
    deliverables: Array<{
      deliverable: string;
      format: string;
      due_date: string | null;
    }>;
    requirements: string[];
    constraints: string[];
    references: string[];
    approval_criteria: string;
  };
  metadata: { model: string; version: number; generated_at: string; };
}
```

---

## Pages & Routes

### `/deliverables` — Deliverable Dashboard (internal, requires auth)
- List of all deliverables for the logged-in strategist
- Columns: title, type (research/roadmap/plan/brief), client name, status (draft/published), created date, word count
- Filter by type, status, client
- Click to open editor

### `/deliverables/:id/edit` — Editor View (internal, requires auth)
- Split-pane layout: **editor on the left, live preview on the right**
- For Research: markdown editor (the content is markdown)
- For Roadmap/Plan/Brief: structured form editor (the content is structured JSON, not markdown)
- Live preview updates as you edit
- Image upload: drag-and-drop or click to insert images into the content
  - Images upload to your file storage (S3/Supabase Storage/etc.)
  - For markdown deliverables: inserts `![alt](url)` at cursor position
  - For structured deliverables: images can be attached to specific sections
- Toolbar: bold, italic, heading levels, table insert, image insert, link insert
- "Publish" button — changes status from draft to published, generates the shareable client link
- "Export PDF" button — generates a styled PDF of the current content
- Auto-save (debounced, save on every pause in editing)

### `/d/:shareId` — Client View (public, no auth required)
- Beautiful, read-only rendering of the published deliverable
- MiD branded: logo in header, brand colors, professional typography
- Cover page with: client name, deliverable title, "Prepared by Marketers in Demand", date
- Table of contents (for research reports)
- Responsive — looks great on desktop and tablet
- No edit controls, no internal navigation — just the deliverable
- "Download PDF" button in the header

---

## Visual Design Requirements

### Brand Treatment
- **Primary colors**: Use MiD's brand palette (the strategist should be able to configure brand colors in settings, but default to MiD's)
- **Typography**: Clean, professional serif or sans-serif. Think McKinsey report, not Google Doc.
- **Cover page**: Full-width, includes client logo (if uploaded), MiD logo, title, date, "Prepared by Marketers in Demand"
- **Headers**: Styled section headers with subtle accent color borders
- **Tables**: Alternating row colors, proper padding, responsive on mobile
- **Competitive scores**: Render as a styled heatmap-style table (green for high scores, red for low)
- **Page breaks**: Visual section separators between major sections

### Research Report Styling (the big one)
- Table of contents at the top, clickable anchor links
- Each section starts with a styled header (number + title)
- Inline links styled as clickable references
- Block quotes styled distinctly (for key findings)
- Code blocks (if any) styled with syntax highlighting
- Horizontal rules between sections
- Word count badge per section (subtle, in the margin or header)
- Print-optimized: CSS @media print rules for clean PDF output

### Roadmap Styling
- **Phase timeline**: Horizontal or vertical timeline with phase cards
- **Initiative cards**: Color-coded by priority (high=red/orange, medium=yellow, low=green)
- **Dependencies**: Visual indicators showing which initiatives depend on others
- **Risk table**: Styled with likelihood color coding
- **Metrics**: Callout boxes for success metrics per phase
- This should feel like a premium strategy deck, not a text document

### Plan Styling
- **Tactic cards**: Grid or list layout with channel icons
- **Timeline**: Visual Gantt-style or milestone timeline
- **KPI dashboard**: Metric cards with targets
- **Budget table**: If budget estimates are present, render as a summary table
- Channel breakdown with icons (LinkedIn, Google, Meta, etc.)

### Brief Styling
- Clean document layout
- Key messages as styled callout cards
- Deliverables as a checklist-style table
- Requirements and constraints as styled lists

---

## Technical Requirements

### Markdown Rendering
- Use `react-markdown` with `remark-gfm` (GitHub Flavored Markdown) for table support
- Custom components for: tables, headings, links, blockquotes, code blocks
- Support for inline images via `![alt](url)` syntax
- Syntax highlighting for any code blocks (unlikely in marketing content, but handle gracefully)

### Image Upload
- Drag-and-drop into the editor area
- Click-to-upload button in the toolbar
- Accept: PNG, JPG, GIF, SVG, WebP
- Max size: 10MB per image
- Store in your file storage (Supabase Storage, S3, Cloudflare R2 — whatever MiD App uses)
- Return a public URL that gets inserted into the content

### PDF Export
- CSS `@media print` for basic print support
- For high-quality PDF: use a library like `react-to-print` or server-side Puppeteer
- PDF should include: cover page, table of contents, all content, page numbers, MiD branding in footer
- Letter size (8.5" x 11") portrait orientation

### Database Schema (new tables)

```sql
-- Stores deliverable documents
CREATE TABLE deliverables (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  -- Link to project/client
  project_id UUID REFERENCES projects(id),
  client_name TEXT NOT NULL,

  -- Content
  type TEXT NOT NULL CHECK (type IN ('research', 'roadmap', 'plan', 'brief')),
  title TEXT NOT NULL,
  summary TEXT,
  content_markdown TEXT,              -- For research: the editable markdown
  content_structured JSONB,           -- For roadmap/plan/brief: the structured data
  competitive_scores JSONB,           -- For research: the scoring data
  generation_metadata JSONB,          -- Original metadata from master-marketer

  -- Status
  status TEXT NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'published', 'archived')),
  share_id TEXT UNIQUE,               -- Short unique ID for public URL (generated on publish)

  -- Timestamps
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  published_at TIMESTAMPTZ,

  -- Owner
  created_by UUID REFERENCES auth.users(id)
);

-- Stores uploaded images for deliverables
CREATE TABLE deliverable_images (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  deliverable_id UUID REFERENCES deliverables(id) ON DELETE CASCADE,
  file_name TEXT NOT NULL,
  storage_path TEXT NOT NULL,
  public_url TEXT NOT NULL,
  file_size INTEGER,
  mime_type TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Index for public share links
CREATE INDEX idx_deliverables_share_id ON deliverables(share_id) WHERE share_id IS NOT NULL;
```

### API Integration with Master-Marketer

Master-marketer triggers jobs via these endpoints:
- `POST /intake/research` → returns `{ jobId }` → poll `GET /jobs/:jobId` → returns `ResearchOutput`
- `POST /intake/roadmap` → returns `{ jobId }` → poll `GET /jobs/:jobId` → returns `RoadmapOutput`
- `POST /intake/plan` → returns `{ jobId }` → poll `GET /jobs/:jobId` → returns `PlanOutput`
- `POST /intake/brief` → returns `{ jobId }` → poll `GET /jobs/:jobId` → returns `BriefOutput`

When the job completes, MiD App should:
1. Create a new row in the `deliverables` table with status='draft'
2. For research: store `full_document_markdown` in `content_markdown`, `competitive_scores` in `competitive_scores`
3. For roadmap/plan/brief: store `content_structured` in `content_structured`
4. Store `metadata` in `generation_metadata`
5. Redirect the strategist to the editor view

---

## User Flows

### Flow 1: Strategist generates + edits + publishes a research report
1. Strategist fills out research intake form in MiD App (client info, competitors, industry)
2. MiD App calls `POST /intake/research` on master-marketer
3. MiD App shows progress indicator (polls `GET /jobs/:jobId`, master-marketer returns progress metadata)
4. When complete, MiD App saves the output to the `deliverables` table
5. Strategist lands on the editor (`/deliverables/:id/edit`)
6. Left pane: markdown editor. Right pane: live rendered preview
7. Strategist reviews, edits wording, inserts a diagram image, fixes a table
8. Strategist clicks "Publish"
9. App generates a `share_id`, sets status to 'published'
10. Strategist copies the share link (`/d/:shareId`) and sends it to the client

### Flow 2: Client views the deliverable
1. Client clicks the share link
2. Sees a beautifully branded, read-only report with MiD cover page
3. Can scroll through all sections, click table of contents
4. Can click "Download PDF" to get a formatted PDF

### Flow 3: Strategist edits a roadmap
1. Same generation flow, but for roadmap type
2. Editor shows structured form fields (not markdown): phase names, initiative descriptions, priorities
3. Right pane shows live visual preview of the roadmap with timeline layout
4. Strategist adjusts priorities, rewords descriptions, adds a phase
5. Publishes — client sees the visual roadmap at the share link

---

## Priority Order

1. **Research report viewer + editor** (this is the most-used deliverable and the most complex)
2. **Public share link with branded rendering**
3. **PDF export**
4. **Image upload in editor**
5. **Roadmap viewer with visual timeline layout**
6. **Plan viewer**
7. **Brief viewer**

Start with #1–4 as the MVP. Roadmap/Plan/Brief viewers can follow.
